<form class="tormenta20 base custom-sheet" autocomplete="off">
	{{!-- Sheet Tab Navigation --}}
	{{> "tormenta20.nav-bar"}}

	{{!-- Sheet Body --}}
	<section class="sheet-body">
		{{!-- Attributes Tab --}}
		<div class="tab attributes flexrow" data-group="primary" data-tab="attributes">

			{{!-- Sheet Header --}}
			{{> "tormenta20.sheet-header-base"}}

			<div class="attributes-left flexcol">
				{{!-- Abilities --}}
				{{> "tormenta20.abilities"}}

				{{!-- HP/MP Resources --}}
				<div class="resources-main">
					<ul class="attributes flexrow">
					{{> "tormenta20.resources"}}
					{{> "tormenta20.defense"}}
					</ul>
				</div>

				{{!-- Extra Resources --}}
				{{#if (or system.resources.shadow system.resources.shadow ) }}
				<div class="resource">
					{{> "tormenta20.resources-extra"}}
				</div>
				{{/if}}

				{{!-- Inventory Weapons --}}
				<div class="inventory-weapons">
					{{> "tormenta20.list-weapon"}}
				</div>

				{{!-- Defense Inventory Equipment --}}
				<div class="inventory-equipment flexrow">
					<!-- <ul class="attributes flexrow"></ul> -->
					{{> "tormenta20.list-equipment"}}
				</div>

				{{!--Powers --}}
				<div class="list-powers-custom">
					<style>
					.list-powers-custom {
						background: linear-gradient(135deg, #2b2f3a 0%, #1f232c 100%);
						border-radius: 14px;
						padding: 18px;
						margin: 10px 0;
						box-shadow: 0 10px 30px rgba(0, 0, 0, 0.55);
						border: 1px solid rgba(255, 255, 255, 0.06);
					}
					
					.powers-header {
						display: flex;
						justify-content: space-between;
						align-items: center;
						margin-bottom: 15px;
						padding-bottom: 10px;
						border-bottom: 2px solid rgba(255, 255, 255, 0.1);
					}
					
					.powers-header h3 {
						margin: 0;
						color: #fff;
						font-size: 18px;
						font-weight: 600;
					}
					
					.powers-chips {
						display: flex;
						flex-wrap: wrap;
						gap: 8px;
						margin-bottom: 15px;
						padding: 12px;
						background: rgba(0, 0, 0, 0.2);
						border-radius: 8px;
						border: 1px solid rgba(255, 255, 255, 0.08);
					}
					
					.power-chip {
						display: inline-flex;
						align-items: center;
						gap: 6px;
						padding: 6px 12px;
						border-radius: 16px;
						font-size: 11px;
						font-weight: 600;
						text-transform: uppercase;
						letter-spacing: 0.5px;
						cursor: pointer;
						transition: all 0.2s ease;
						border: 2px solid transparent;
						user-select: none;
					}
					
					.power-chip:hover {
						transform: translateY(-2px);
						box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
					}
					
					.power-chip.active {
						border-color: rgba(255, 255, 255, 0.5);
						box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2);
					}
					
					.power-chip .chip-count {
						display: inline-flex;
						align-items: center;
						justify-content: center;
						min-width: 20px;
						height: 20px;
						padding: 0 6px;
						border-radius: 10px;
						background: rgba(0, 0, 0, 0.3);
						font-size: 10px;
						font-weight: 700;
					}
					
					.power-chip.active .chip-count {
						background: rgba(255, 255, 255, 0.3);
					}
					
					.power-chip[data-type="geral"] {
						background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
						color: #fff;
					}
					
					.power-chip[data-type="origem"] {
						background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
						color: #fff;
					}
					
					.power-chip[data-type="classe"] {
						background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
						color: #fff;
					}
					
					.power-chip[data-type="habilidade-de-classe"] {
						background: linear-gradient(135deg, #f5c242 0%, #f39c12 100%);
						color: #fff;
					}
					
					.power-chip[data-type="racial"] {
						background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
						color: #fff;
					}
					
					.power-chip[data-type="concedido"] {
						background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%);
						color: #fff;
					}
					
					.power-chip[data-type="distinção"],
					.power-chip[data-type="distincao"] {
						background: linear-gradient(135deg, #16a085 0%, #138d75 100%);
						color: #fff;
					}
					
					.power-chip[data-type="complicação"],
					.power-chip[data-type="complicacao"],
					.power-chip[data-type="complicacão"] {
						background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
						color: #fff;
					}
					
					.powers-filters {
						display: flex;
						gap: 10px;
						margin-bottom: 15px;
						flex-wrap: wrap;
					}
					
					.power-filter-input {
						flex: 1;
						min-width: 200px;
						padding: 8px 12px;
						background: rgba(255, 255, 255, 0.1);
						border: 1px solid rgba(255, 255, 255, 0.2);
						border-radius: 6px;
						color: #fff;
						font-size: 13px;
					}
					
					.power-filter-input::placeholder {
						color: rgba(255, 255, 255, 0.5);
					}
					
					.power-filter-type {
						padding: 8px 12px;
						background: rgba(255, 255, 255, 0.1);
						border: 1px solid rgba(255, 255, 255, 0.2);
						border-radius: 6px;
						color: #fff;
						font-size: 13px;
						cursor: pointer;
					}
					
					.powers-list {
						max-height: 400px;
						overflow-y: auto;
						padding-right: 5px;
					}
					
					.powers-list::-webkit-scrollbar {
						width: 8px;
					}
					
					.powers-list::-webkit-scrollbar-track {
						background: rgba(0, 0, 0, 0.2);
						border-radius: 4px;
					}
					
					.powers-list::-webkit-scrollbar-thumb {
						background: rgba(255, 255, 255, 0.3);
						border-radius: 4px;
					}
					
					.powers-group {
						margin-top: 4px;
					}
					
					.powers-group-header {
						display: flex;
						justify-content: space-between;
						align-items: center;
						margin: 14px 4px 6px;
						font-size: 11px;
						text-transform: uppercase;
						letter-spacing: 0.08em;
						color: rgba(255, 255, 255, 0.7);
					}
					
					.powers-group-header .group-title {
						font-weight: 700;
					}
					
					.powers-group-header .group-count {
						font-weight: 600;
						font-size: 10px;
						opacity: 0.85;
					}
					
					.power-item {
						display: flex;
						align-items: center;
						gap: 12px;
						padding: 12px 14px;
						margin-bottom: 8px;
						background: rgba(10, 12, 18, 0.85);
						border: 1px solid rgba(255, 255, 255, 0.06);
						border-radius: 10px;
						transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease, border-color 0.18s ease;
					}
					
					.power-item:hover {
						background: rgba(18, 22, 32, 0.98);
						border-color: rgba(255, 255, 255, 0.16);
						box-shadow: 0 6px 18px rgba(0, 0, 0, 0.45);
						transform: translateX(4px);
					}
					
					.power-item.hidden {
						display: none;
					}
					
					.power-icon {
						width: 40px;
						height: 40px;
						border-radius: 6px;
						background-size: cover;
						background-position: center;
						flex-shrink: 0;
						border: 2px solid rgba(255, 255, 255, 0.2);
					}
					
					.power-info {
						flex: 1;
						min-width: 0;
					}
					
					.power-name {
						font-size: 14px;
						font-weight: 600;
						color: #fff;
						margin-bottom: 4px;
					}
					
					.power-activation {
						font-size: 11px;
						color: rgba(255, 255, 255, 0.7);
					}
					
					.power-type-badge {
						display: inline-block;
						padding: 4px 10px;
						border-radius: 12px;
						font-size: 10px;
						font-weight: 700;
						text-transform: uppercase;
						letter-spacing: 0.5px;
						white-space: nowrap;
						margin-right: 8px;
						flex-shrink: 0;
					}
					
					.power-type-geral { background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: #fff; }
					.power-type-origem { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: #fff; }
					.power-type-classe { background: linear-gradient(135deg, #e67e22 0%, #d35400 100%); color: #fff; }
					.power-type-habilidade-de-classe { background: linear-gradient(135deg, #f5c242 0%, #f39c12 100%); color: #fff; }
					.power-type-habilidade_de_classe { background: linear-gradient(135deg, #f5c242 0%, #f39c12 100%); color: #fff; }
					.power-type-racial { background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: #fff; }
					.power-type-concedido { background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%); color: #fff; }
					.power-type-distinção { background: linear-gradient(135deg, #16a085 0%, #138d75 100%); color: #fff; }
					.power-type-distincao { background: linear-gradient(135deg, #16a085 0%, #138d75 100%); color: #fff; }
					.power-type-complicação { background: linear-gradient(135deg, #c0392b 0%, #a93226 100%); color: #fff; }
					.power-type-complicacao { background: linear-gradient(135deg, #c0392b 0%, #a93226 100%); color: #fff; }
					.power-type-complicacão { background: linear-gradient(135deg, #c0392b 0%, #a93226 100%); color: #fff; }
					
					.power-controls {
						display: flex;
						gap: 5px;
					}
					
					.power-control {
						padding: 6px 10px;
						background: rgba(255, 255, 255, 0.1);
						border: 1px solid rgba(255, 255, 255, 0.2);
						border-radius: 4px;
						color: #fff;
						cursor: pointer;
						transition: all 0.2s ease;
					}
					
					.power-control:hover {
						background: rgba(255, 255, 255, 0.2);
					}
					</style>
					
					<div class="powers-header">
						<h3>{{localize "T20.Powers"}}</h3>
						<a class="item-control item-create power-control" title="{{localize 'T20.ItemCreate'}}" data-type="poder">
							<i class="fas fa-plus"></i> {{localize "T20.Add"}}
						</a>
					</div>
					
					<div class="powers-chips" id="powers-chips-container">
						<!-- Chips serão criados dinamicamente via JavaScript -->
					</div>
					
					<div class="powers-filters">
						<input type="text" class="power-filter-input" id="power-filter-name" placeholder="Filtrar por nome...">
						<select class="power-filter-type" id="power-filter-type">
							<option value="">Todos os tipos</option>
							<option value="habilidade-de-classe">Habilidade de Classe</option>
							<option value="classe">Classe</option>
							<option value="concedido">Concedido</option>
							<option value="geral">Geral</option>
							<option value="origem">Origem</option>
							<option value="racial">Racial</option>
							<option value="distinção">Distinção</option>
							<option value="complicação">Complicação</option>
						</select>
					</div>
					
					<div class="powers-list" id="powers-list-container">
						{{#if actor.poderesPorTipo.length}}
							{{#each actor.poderesPorTipo as |grupo|}}
							<div class="powers-group" data-power-group="{{grupo.tipo}}">
								<div class="powers-group-header">
									<span class="group-title">{{grupo.label}}</span>
									<span class="group-count">{{grupo.count}}</span>
								</div>
								
								{{#each grupo.items as |item id|}}
								<div class="power-item" data-item-id="{{item._id}}" data-power-name="{{item.name}}" data-power-type="{{item.tipo}}">
									<div class="power-icon" style="background-image: url('{{item.img}}')"></div>
									<div class="power-info">
										<div class="power-name">{{item.name}}</div>
										<div class="power-activation" data-item-id="{{item._id}}">
											<span class="activation-text">-</span>
											<span class="mana-cost" style="display: none;"></span>
										</div>
									</div>
									<div class="power-type-badge power-type-placeholder" style="display: none;"></div>
									<div class="power-controls">
										<a class="item-control item-edit power-control" title="{{localize 'T20.ItemEdit'}}" data-item-id="{{item._id}}">
											<i class="fas fa-edit"></i>
										</a>
										<a class="item-control item-delete power-control" title="{{localize 'T20.ItemDelete'}}" data-item-id="{{item._id}}">
											<i class="fas fa-trash"></i>
										</a>
									</div>
								</div>
								{{/each}}
							</div>
							{{/each}}
						{{else}}
							{{#each actor.poderes as |item id|}}
							<div class="power-item" data-item-id="{{item._id}}" data-power-name="{{item.name}}" data-power-type="">
								<div class="power-icon" style="background-image: url('{{item.img}}')"></div>
								<div class="power-info">
									<div class="power-name">{{item.name}}</div>
									<div class="power-activation" data-item-id="{{item._id}}">
										<span class="activation-text">-</span>
										<span class="mana-cost" style="display: none;"></span>
									</div>
								</div>
								<div class="power-type-badge power-type-placeholder" style="display: none;"></div>
								<div class="power-controls">
									<a class="item-control item-edit power-control" title="{{localize 'T20.ItemEdit'}}" data-item-id="{{item._id}}">
										<i class="fas fa-edit"></i>
									</a>
									<a class="item-control item-delete power-control" title="{{localize 'T20.ItemDelete'}}" data-item-id="{{item._id}}">
										<i class="fas fa-trash"></i>
									</a>
								</div>
							</div>
							{{/each}}
						{{/if}}
					</div>
				</div>

				{{#if actor.maiorCirculo}}
				{{!-- Spells --}}
				<div class="list-spells">
					{{> "tormenta20.list-spells"}}
				</div>
				{{/if}}

				{{!-- Traits --}}
				<div class="traits">
					{{> "tormenta20.traits"}}
					<textarea name="system.detalhes.info" rows="10">{{system.detalhes.info}}</textarea>
				</div>
			</div>
			<div class="attributes-right flexcol">
				{{!-- Skills --}}
				{{> "tormenta20.list-skills"}}

				{{!-- Inventory General --}}
				<div class="inventory-list">
					{{> "tormenta20.list-general"}}
					{{> "tormenta20.currency"}}
					{{> "tormenta20.encumbrance"}}
				</div>
			</div>
		</div>

		{{!-- Biography Tab --}}
		<div class="tab journal flexrow flex-between" data-group="primary" data-tab="journal">
			{{> "tormenta20.journal"}}
		</div>

		{{!-- Modifiers Tab --}}
		<div class="tab modifiers" data-group="primary" data-tab="modifiers">
			{{> "tormenta20.modifiers"}}
		</div>

		{{!-- Efeitos Tab --}}
		<div class="tab effects" data-group="primary" data-tab="effects">
			{{> "tormenta20.active-effects"}}
		</div>
	</section>
</form>
