<form class="tormenta20 base custom-sheet" autocomplete="off">
	{{!-- Sheet Tab Navigation --}}
	{{> "tormenta20.nav-bar"}}

	{{!-- Sheet Body --}}
	<section class="sheet-body">
		{{!-- Attributes Tab --}}
		<div class="tab attributes flexrow" data-group="primary" data-tab="attributes">

			{{!-- Sheet Header --}}
			{{> "tormenta20.sheet-header-base"}}

			<div class="attributes-left flexcol">
				{{!-- Abilities --}}
				{{> "tormenta20.abilities"}}

				{{!-- HP/MP Resources --}}
				<div class="resources-main">
					<ul class="attributes flexrow">
					{{> "tormenta20.resources"}}
					{{> "tormenta20.defense"}}
					</ul>
				</div>

				{{!-- Extra Resources --}}
				{{#if (or system.resources.shadow system.resources.shadow ) }}
				<div class="resource">
					{{> "tormenta20.resources-extra"}}
				</div>
				{{/if}}

				{{!-- Inventory Weapons --}}
				<div class="inventory-weapons">
					{{> "tormenta20.list-weapon"}}
				</div>

				{{!-- Defense Inventory Equipment --}}
				<div class="inventory-equipment flexrow">
					<!-- <ul class="attributes flexrow"></ul> -->
					{{> "tormenta20.list-equipment"}}
				</div>

				{{!--Powers --}}
				<div class="list-powers-custom">
					<style>
					.list-powers-custom {
						background: linear-gradient(145deg, #1a1d26 0%, #13151c 100%);
						border-radius: 16px;
						padding: 20px;
						margin: 12px 0;
						box-shadow: 
							0 8px 32px rgba(0, 0, 0, 0.6),
							0 2px 8px rgba(0, 0, 0, 0.4),
							inset 0 1px 0 rgba(255, 255, 255, 0.05);
						border: 1px solid rgba(255, 255, 255, 0.08);
						position: relative;
						overflow: hidden;
					}
					
					.list-powers-custom::before {
						content: '';
						position: absolute;
						top: 0;
						left: 0;
						right: 0;
						height: 3px;
						background: linear-gradient(90deg, 
							rgba(245, 194, 66, 0.8) 0%,
							rgba(230, 126, 34, 0.8) 25%,
							rgba(74, 144, 226, 0.8) 50%,
							rgba(155, 89, 182, 0.8) 75%,
							rgba(39, 174, 96, 0.8) 100%);
						opacity: 0.6;
					}
					
					.powers-header {
						display: flex;
						justify-content: space-between;
						align-items: center;
						margin-bottom: 16px;
						padding-bottom: 12px;
						border-bottom: 2px solid rgba(255, 255, 255, 0.12);
						position: relative;
					}
					
					.powers-header::after {
						content: '';
						position: absolute;
						bottom: -2px;
						left: 0;
						width: 60px;
						height: 2px;
						background: linear-gradient(90deg, rgba(245, 194, 66, 1), rgba(245, 194, 66, 0));
					}
					
					.powers-header h3 {
						margin: 0;
						color: #ffffff;
						font-size: 22px;
						font-weight: 700;
						letter-spacing: -0.5px;
						text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
						position: relative;
					}
					
					.powers-combobox-container {
						margin-bottom: 16px;
						position: relative;
					}
					
					.powers-combobox {
						width: 100%;
						padding: 10px 40px 10px 16px;
						background: rgba(255, 255, 255, 0.05);
						border: 2px solid rgba(255, 255, 255, 0.1);
						border-radius: 10px;
						color: transparent !important; /* Tornar texto transparente para usar o overlay */
						font-size: 14px;
						font-weight: 500;
						cursor: pointer;
						transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
						outline: none;
						appearance: none;
						box-shadow: 
							inset 0 2px 4px rgba(0, 0, 0, 0.2),
							0 2px 8px rgba(0, 0, 0, 0.1);
						-webkit-appearance: none;
						-moz-appearance: none;
						position: relative;
						z-index: 2;
						height: 40px;
						line-height: 40px;
					}
					
					/* Overlay para mostrar o texto selecionado */
					.powers-combobox-container::before {
						content: attr(data-selected-text);
						position: absolute;
						left: 16px;
						top: 50%;
						transform: translateY(-50%);
						color: #ffffff;
						font-size: 14px;
						font-weight: 500;
						pointer-events: none;
						z-index: 3;
						max-width: calc(100% - 56px);
						overflow: hidden;
						text-overflow: ellipsis;
						white-space: nowrap;
						line-height: 1.5;
						-webkit-font-smoothing: antialiased;
						-moz-osx-font-smoothing: grayscale;
						text-rendering: optimizeLegibility;
					}
					
					/* Garantir que o texto selecionado seja visível */
					.powers-combobox option {
						background: #1a1d26;
						color: #ffffff !important;
						padding: 10px;
					}
					
					.powers-combobox option:hover {
						background: rgba(245, 194, 66, 0.2);
					}
					
					.powers-combobox option:checked,
					.powers-combobox option[selected] {
						background: rgba(245, 194, 66, 0.2);
						color: #ffffff !important;
					}
					
					/* Garantir que o texto no select seja sempre visível */
					.powers-combobox,
					.powers-combobox:focus,
					.powers-combobox:active {
						color: #ffffff !important;
					}
					
					.powers-combobox:hover {
						border-color: rgba(255, 255, 255, 0.2);
						background: rgba(255, 255, 255, 0.08);
					}
					
					.powers-combobox:focus {
						border-color: rgba(245, 194, 66, 0.6);
						background: rgba(255, 255, 255, 0.1);
						box-shadow: 
							inset 0 2px 4px rgba(0, 0, 0, 0.2),
							0 0 0 4px rgba(245, 194, 66, 0.2),
							0 4px 12px rgba(0, 0, 0, 0.2);
					}
					
					.powers-combobox-container::after {
						content: '';
						position: absolute;
						right: 16px;
						top: 50%;
						transform: translateY(-50%);
						width: 0;
						height: 0;
						border-left: 6px solid transparent;
						border-right: 6px solid transparent;
						border-top: 8px solid rgba(255, 255, 255, 0.6);
						pointer-events: none;
						transition: border-top-color 0.3s ease;
						z-index: 1;
					}
					
					.powers-combobox-container:hover::after {
						border-top-color: rgba(245, 194, 66, 1);
					}
					
					
					.powers-chips {
						display: none;
					}
					
					.power-chip {
						display: inline-flex;
						align-items: center;
						gap: 8px;
						padding: 8px 16px;
						border-radius: 20px;
						font-size: 11px;
						font-weight: 700;
						text-transform: uppercase;
						letter-spacing: 0.8px;
						cursor: pointer;
						transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
						border: 2px solid transparent;
						user-select: none;
						position: relative;
						overflow: hidden;
						box-shadow: 
							0 2px 8px rgba(0, 0, 0, 0.3),
							inset 0 1px 0 rgba(255, 255, 255, 0.1);
						background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
						color: #fff;
					}
					
					.power-chip::before {
						content: '';
						position: absolute;
						top: 0;
						left: -100%;
						width: 100%;
						height: 100%;
						background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
						transition: left 0.5s ease;
					}
					
					.power-chip:hover::before {
						left: 100%;
					}
					
					.power-chip:hover {
						transform: translateY(-3px) scale(1.05);
						box-shadow: 
							0 6px 20px rgba(0, 0, 0, 0.5),
							0 0 0 3px rgba(255, 255, 255, 0.1);
						filter: brightness(1.1);
					}
					
					.power-chip.active {
						border-color: rgba(255, 255, 255, 0.6);
						box-shadow: 
							0 4px 16px rgba(0, 0, 0, 0.4),
							0 0 0 3px rgba(255, 255, 255, 0.2),
							inset 0 2px 4px rgba(0, 0, 0, 0.2);
						filter: brightness(1.15);
						transform: translateY(-2px);
					}
					
					.power-chip .chip-count {
						display: inline-flex;
						align-items: center;
						justify-content: center;
						min-width: 24px;
						height: 24px;
						padding: 0 8px;
						border-radius: 12px;
						background: rgba(0, 0, 0, 0.4);
						font-size: 11px;
						font-weight: 800;
						box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
						border: 1px solid rgba(255, 255, 255, 0.1);
					}
					
					.power-chip.active .chip-count {
						background: rgba(255, 255, 255, 0.25);
						border-color: rgba(255, 255, 255, 0.3);
						box-shadow: 
							inset 0 2px 4px rgba(0, 0, 0, 0.2),
							0 2px 4px rgba(255, 255, 255, 0.1);
					}
					
					.power-chip[data-type="geral"] {
						background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
						color: #fff;
					}
					
					.power-chip[data-type="origem"] {
						background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
						color: #fff;
					}
					
					.power-chip[data-type="classe"] {
						background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
						color: #fff;
					}
					
					.power-chip[data-type="habilidade-de-classe"],
					.power-chip[data-type="habilidade_de_classe"],
					.power-chip[data-type*="habilidade"][data-type*="classe"] {
						background: linear-gradient(135deg, #f5c242 0%, #f39c12 100%);
						color: #fff;
					}
					
					.power-chip[data-type="racial"] {
						background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
						color: #fff;
					}
					
					.power-chip[data-type="concedido"] {
						background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%);
						color: #fff;
					}
					
					.power-chip[data-type="distinção"],
					.power-chip[data-type="distincao"] {
						background: linear-gradient(135deg, #16a085 0%, #138d75 100%);
						color: #fff;
					}
					
					.power-chip[data-type="complicação"],
					.power-chip[data-type="complicacao"],
					.power-chip[data-type="complicacão"] {
						background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
						color: #fff;
					}
					
					.powers-filters {
						display: flex;
						gap: 8px;
						margin-bottom: 16px;
						flex-wrap: wrap;
					}
					
					.power-filter-input {
						flex: 1;
						min-width: 180px;
						padding: 6px 10px;
						background: transparent;
						border: none;
						border-bottom: 2px solid rgba(255, 255, 255, 0.15);
						border-radius: 0;
						color: #ffffff;
						font-size: 13px;
						transition: all 0.2s ease;
						outline: none;
					}
					
					.power-filter-input:focus {
						border-bottom-color: rgba(245, 194, 66, 0.8);
						background: rgba(255, 255, 255, 0.03);
					}
					
					.power-filter-input::placeholder {
						color: rgba(255, 255, 255, 0.35);
						font-style: italic;
					}
					
					.power-filter-type {
						padding: 6px 28px 6px 10px;
						background: transparent;
						border: none;
						border-bottom: 2px solid rgba(255, 255, 255, 0.15);
						border-radius: 0;
						color: #ffffff;
						font-size: 13px;
						cursor: pointer;
						transition: all 0.2s ease;
						outline: none;
						appearance: none;
						background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 12 12'%3E%3Cpath fill='%23ffffff' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
						background-repeat: no-repeat;
						background-position: right 8px center;
						opacity: 0.8;
					}
					
					.power-filter-type:focus {
						border-bottom-color: rgba(245, 194, 66, 0.8);
						background-color: rgba(255, 255, 255, 0.03);
						opacity: 1;
					}
					
					.power-filter-type:hover {
						border-bottom-color: rgba(255, 255, 255, 0.25);
						opacity: 1;
					}
					
					.powers-list {
						max-height: 450px;
						overflow-y: auto;
						padding-right: 8px;
						padding-top: 4px;
					}
					
					.powers-list::-webkit-scrollbar {
						width: 10px;
					}
					
					.powers-list::-webkit-scrollbar-track {
						background: rgba(0, 0, 0, 0.2);
						border-radius: 10px;
						border: 1px solid rgba(255, 255, 255, 0.05);
					}
					
					.powers-list::-webkit-scrollbar-thumb {
						background: linear-gradient(180deg, 
							rgba(245, 194, 66, 0.6) 0%,
							rgba(230, 126, 34, 0.6) 100%);
						border-radius: 10px;
						border: 2px solid rgba(0, 0, 0, 0.2);
						box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2);
					}
					
					.powers-list::-webkit-scrollbar-thumb:hover {
						background: linear-gradient(180deg, 
							rgba(245, 194, 66, 0.8) 0%,
							rgba(230, 126, 34, 0.8) 100%);
					}
					
					.powers-group {
						margin-top: 4px;
					}
					
					.powers-group-header {
						display: flex;
						justify-content: space-between;
						align-items: center;
						margin: 14px 4px 6px;
						font-size: 11px;
						text-transform: uppercase;
						letter-spacing: 0.08em;
						color: rgba(255, 255, 255, 0.7);
					}
					
					.powers-group-header .group-title {
						font-weight: 700;
					}
					
					.powers-group-header .group-count {
						font-weight: 600;
						font-size: 10px;
						opacity: 0.85;
					}
					
					.power-item {
						display: flex;
						flex-direction: column;
						gap: 0;
						padding: 16px 18px;
						margin-bottom: 12px;
						background: rgba(22, 26, 35, 0.95);
						border: 1px solid rgba(255, 255, 255, 0.08);
						border-radius: 12px;
						transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
						opacity: 0;
						transform: translateY(-10px);
						animation: powerItemEnter 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
						box-shadow: 
							0 4px 12px rgba(0, 0, 0, 0.3),
							inset 0 1px 0 rgba(255, 255, 255, 0.05);
						position: relative;
						overflow: hidden;
					}
					
					.power-item::before {
						content: '';
						position: absolute;
						top: 0;
						left: 0;
						width: 4px;
						height: 100%;
						background: linear-gradient(180deg, 
							rgba(245, 194, 66, 0.8) 0%,
							rgba(230, 126, 34, 0.8) 100%);
						opacity: 0;
						transition: opacity 0.3s ease;
					}
					
					@keyframes powerItemEnter {
						from {
							opacity: 0;
							transform: translateY(-10px);
						}
						to {
							opacity: 1;
							transform: translateY(0);
						}
					}
					
					.power-item-row {
						display: flex;
						align-items: center;
						gap: 12px;
					}
					
					.power-item:hover {
						background: rgba(28, 32, 42, 1);
						border-color: rgba(255, 255, 255, 0.2);
						box-shadow: 
							0 8px 24px rgba(0, 0, 0, 0.5),
							0 0 0 1px rgba(255, 255, 255, 0.1),
							inset 0 1px 0 rgba(255, 255, 255, 0.08);
						transform: translateX(6px) translateY(-2px);
					}
					
					.power-item:hover::before {
						opacity: 1;
					}
					
					.power-item.hidden {
						opacity: 0 !important;
						max-height: 0 !important;
						margin-bottom: 0 !important;
						padding-top: 0 !important;
						padding-bottom: 0 !important;
						overflow: hidden;
						transform: translateY(-5px) scale(0.95);
						pointer-events: none;
						animation: none !important;
					}
					
					.power-item.entering {
						animation: powerItemEnter 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
					}
					
					/* Indicadores visuais especiais para todos os tipos de poderes */
					/* Geral - Azul */
					.power-item[data-power-type="geral"] {
						border-left: 4px solid rgba(74, 144, 226, 0.9);
						box-shadow: inset 0 0 0 1px rgba(74, 144, 226, 0.2);
					}
					.power-item[data-power-type="geral"] .power-icon {
						border-color: rgba(74, 144, 226, 0.6);
						box-shadow: 0 0 10px rgba(74, 144, 226, 0.4);
					}
					.power-item[data-power-type="geral"]:hover {
						border-left-color: rgba(74, 144, 226, 1);
						box-shadow: inset 0 0 0 1px rgba(74, 144, 226, 0.3), 0 6px 18px rgba(0, 0, 0, 0.45);
					}
					
					/* Origem - Roxo */
					.power-item[data-power-type="origem"] {
						border-left: 4px solid rgba(155, 89, 182, 0.9);
						box-shadow: inset 0 0 0 1px rgba(155, 89, 182, 0.2);
					}
					.power-item[data-power-type="origem"] .power-icon {
						border-color: rgba(155, 89, 182, 0.6);
						box-shadow: 0 0 10px rgba(155, 89, 182, 0.4);
					}
					.power-item[data-power-type="origem"]:hover {
						border-left-color: rgba(155, 89, 182, 1);
						box-shadow: inset 0 0 0 1px rgba(155, 89, 182, 0.3), 0 6px 18px rgba(0, 0, 0, 0.45);
					}
					
					/* Classe - Laranja */
					.power-item[data-power-type="classe"] {
						border-left: 4px solid rgba(230, 126, 34, 0.9);
						box-shadow: inset 0 0 0 1px rgba(230, 126, 34, 0.2);
					}
					.power-item[data-power-type="classe"] .power-icon {
						border-color: rgba(230, 126, 34, 0.6);
						box-shadow: 0 0 10px rgba(230, 126, 34, 0.4);
					}
					.power-item[data-power-type="classe"]:hover {
						border-left-color: rgba(230, 126, 34, 1);
						box-shadow: inset 0 0 0 1px rgba(230, 126, 34, 0.3), 0 6px 18px rgba(0, 0, 0, 0.45);
					}
					
					/* Habilidade de Classe - Dourado */
					/* Priorizar a classe CSS que é mais confiável */
					.power-item.power-type-item-habilidade-de-classe,
					.power-item[data-power-type="habilidade-de-classe"],
					.power-item[data-power-type="habilidade_de_classe"],
					.power-item[data-power-type*="habilidade"][data-power-type*="classe"] {
						border-left: 4px solid rgba(245, 194, 66, 0.9) !important;
						box-shadow: inset 0 0 0 1px rgba(245, 194, 66, 0.2) !important;
					}
					.power-item.power-type-item-habilidade-de-classe .power-icon,
					.power-item[data-power-type="habilidade-de-classe"] .power-icon,
					.power-item[data-power-type="habilidade_de_classe"] .power-icon,
					.power-item[data-power-type*="habilidade"][data-power-type*="classe"] .power-icon {
						border-color: rgba(245, 194, 66, 0.6) !important;
						box-shadow: 0 0 10px rgba(245, 194, 66, 0.4) !important;
					}
					.power-item.power-type-item-habilidade-de-classe:hover,
					.power-item[data-power-type="habilidade-de-classe"]:hover,
					.power-item[data-power-type="habilidade_de_classe"]:hover,
					.power-item[data-power-type*="habilidade"][data-power-type*="classe"]:hover {
						border-left-color: rgba(245, 194, 66, 1) !important;
						box-shadow: inset 0 0 0 1px rgba(245, 194, 66, 0.3), 0 6px 18px rgba(0, 0, 0, 0.45) !important;
					}
					
					/* Racial - Verde */
					.power-item[data-power-type="racial"] {
						border-left: 4px solid rgba(39, 174, 96, 0.9);
						box-shadow: inset 0 0 0 1px rgba(39, 174, 96, 0.2);
					}
					.power-item[data-power-type="racial"] .power-icon {
						border-color: rgba(39, 174, 96, 0.6);
						box-shadow: 0 0 10px rgba(39, 174, 96, 0.4);
					}
					.power-item[data-power-type="racial"]:hover {
						border-left-color: rgba(39, 174, 96, 1);
						box-shadow: inset 0 0 0 1px rgba(39, 174, 96, 0.3), 0 6px 18px rgba(0, 0, 0, 0.45);
					}
					
					/* Concedido - Roxo Escuro */
					.power-item[data-power-type="concedido"] {
						border-left: 4px solid rgba(142, 68, 173, 0.9);
						box-shadow: inset 0 0 0 1px rgba(142, 68, 173, 0.2);
					}
					.power-item[data-power-type="concedido"] .power-icon {
						border-color: rgba(142, 68, 173, 0.6);
						box-shadow: 0 0 10px rgba(142, 68, 173, 0.4);
					}
					.power-item[data-power-type="concedido"]:hover {
						border-left-color: rgba(142, 68, 173, 1);
						box-shadow: inset 0 0 0 1px rgba(142, 68, 173, 0.3), 0 6px 18px rgba(0, 0, 0, 0.45);
					}
					
					/* Distinção - Verde Água */
					.power-item[data-power-type="distinção"],
					.power-item[data-power-type="distincao"] {
						border-left: 4px solid rgba(22, 160, 133, 0.9);
						box-shadow: inset 0 0 0 1px rgba(22, 160, 133, 0.2);
					}
					.power-item[data-power-type="distinção"] .power-icon,
					.power-item[data-power-type="distincao"] .power-icon {
						border-color: rgba(22, 160, 133, 0.6);
						box-shadow: 0 0 10px rgba(22, 160, 133, 0.4);
					}
					.power-item[data-power-type="distinção"]:hover,
					.power-item[data-power-type="distincao"]:hover {
						border-left-color: rgba(22, 160, 133, 1);
						box-shadow: inset 0 0 0 1px rgba(22, 160, 133, 0.3), 0 6px 18px rgba(0, 0, 0, 0.45);
					}
					
					/* Complicação - Vermelho */
					.power-item[data-power-type="complicação"],
					.power-item[data-power-type="complicacao"],
					.power-item[data-power-type="complicacão"] {
						border-left: 4px solid rgba(192, 57, 43, 0.9);
						box-shadow: inset 0 0 0 1px rgba(192, 57, 43, 0.2);
					}
					.power-item[data-power-type="complicação"] .power-icon,
					.power-item[data-power-type="complicacao"] .power-icon,
					.power-item[data-power-type="complicacão"] .power-icon {
						border-color: rgba(192, 57, 43, 0.6);
						box-shadow: 0 0 10px rgba(192, 57, 43, 0.4);
					}
					.power-item[data-power-type="complicação"]:hover,
					.power-item[data-power-type="complicacao"]:hover,
					.power-item[data-power-type="complicacão"]:hover {
						border-left-color: rgba(192, 57, 43, 1);
						box-shadow: inset 0 0 0 1px rgba(192, 57, 43, 0.3), 0 6px 18px rgba(0, 0, 0, 0.45);
					}
					
					.power-icon {
						width: 48px;
						height: 48px;
						border-radius: 10px;
						background-size: cover;
						background-position: center;
						flex-shrink: 0;
						border: 2px solid rgba(255, 255, 255, 0.15);
						cursor: pointer;
						transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
						position: relative;
						box-shadow: 
							0 2px 8px rgba(0, 0, 0, 0.3),
							inset 0 1px 0 rgba(255, 255, 255, 0.1);
					}
					
					.power-icon::after {
						content: '';
						position: absolute;
						inset: 0;
						border-radius: 8px;
						padding: 2px;
						background: linear-gradient(135deg, 
							rgba(255, 255, 255, 0.3) 0%,
							rgba(255, 255, 255, 0.05) 100%);
						-webkit-mask: linear-gradient(#fff 0 0) content-box, 
									   linear-gradient(#fff 0 0);
						-webkit-mask-composite: xor;
						mask-composite: exclude;
						opacity: 0;
						transition: opacity 0.3s ease;
					}
					
					.power-icon:hover {
						transform: scale(1.15) rotate(2deg);
						box-shadow: 
							0 4px 16px rgba(0, 0, 0, 0.4),
							0 0 20px rgba(245, 194, 66, 0.4);
						border-color: rgba(245, 194, 66, 0.6);
						z-index: 1;
					}
					
					.power-icon:hover::after {
						opacity: 1;
					}
					
					.power-icon:active {
						transform: scale(1.1) rotate(1deg);
					}
					
					.power-info {
						flex: 1;
						min-width: 0;
					}
					
					.power-name {
						font-size: 15px;
						font-weight: 600;
						color: #ffffff;
						margin-bottom: 6px;
						cursor: pointer;
						user-select: none;
						transition: all 0.3s ease;
						line-height: 1.4;
						text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
					}
					
					.power-name:hover {
						color: rgba(245, 194, 66, 1);
						text-shadow: 0 2px 4px rgba(245, 194, 66, 0.3);
					}
					
					/* Painel expansível de detalhes do poder */
					.power-details-panel {
						display: none;
						margin-top: 10px;
						margin-left: -14px;
						margin-right: -14px;
						margin-bottom: -12px;
						padding: 12px 14px;
						background: rgba(0, 0, 0, 0.75);
						border-top: 1px solid rgba(255, 255, 255, 0.1);
						border-radius: 0 0 10px 10px;
						color: #ffffff;
						font-size: 12px;
						line-height: 1.6;
						animation: slideDown 0.2s ease-out;
					}
					
					.power-item.expanded .power-details-panel {
						display: block;
					}
					
					@keyframes slideDown {
						from {
							opacity: 0;
							transform: translateY(-5px);
						}
						to {
							opacity: 1;
							transform: translateY(0);
						}
					}
					
					.power-details-header {
						margin-bottom: 8px;
						padding-bottom: 8px;
						border-bottom: 1px solid rgba(255, 255, 255, 0.15);
					}
					
					.power-details-title {
						font-weight: 700;
						font-size: 13px;
						color: #ffffff;
					}
					
					.power-details-row {
						display: flex;
						justify-content: space-between;
						align-items: center;
						margin-bottom: 5px;
						padding: 2px 0;
						color: #ffffff;
					}
					
					.power-details-label {
						font-weight: 600;
						color: rgba(255, 255, 255, 0.8);
						font-size: 11px;
						text-transform: uppercase;
						letter-spacing: 0.03em;
					}
					
					.power-details-value {
						color: #ffffff;
						text-align: right;
						font-weight: 500;
						flex: 1;
						margin-left: 12px;
						font-size: 12px;
					}
					
					.power-details-description {
						margin-top: 10px;
						padding-top: 10px;
						border-top: 1px solid rgba(255, 255, 255, 0.15);
						color: rgba(255, 255, 255, 0.9);
						font-size: 12px;
						line-height: 1.6;
						word-wrap: break-word;
					}
					
					.power-details-description:empty {
						display: none;
					}
					
					/* Estilo para pré-requisitos e outros elementos especiais na descrição */
					.power-details-description em,
					.power-details-description i {
						font-style: italic;
						color: rgba(255, 255, 255, 0.85);
					}
					
					.power-details-description strong {
						font-weight: 600;
						color: #ffffff;
					}
					
					.power-details-description p {
						margin: 0 0 6px 0;
					}
					
					.power-details-description p:last-child {
						margin-bottom: 0;
					}
					
					.power-details-description ul,
					.power-details-description ol {
						margin: 6px 0;
						padding-left: 18px;
					}
					
					.power-details-description li {
						margin-bottom: 3px;
					}
					
					.power-activation {
						font-size: 11px;
						color: rgba(255, 255, 255, 0.7);
					}
					
					.power-type-badge {
						display: inline-block;
						padding: 4px 10px;
						border-radius: 12px;
						font-size: 10px;
						font-weight: 700;
						text-transform: uppercase;
						letter-spacing: 0.5px;
						white-space: nowrap;
						margin-right: 8px;
						flex-shrink: 0;
					}
					
					.power-type-geral { background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: #fff; }
					.power-type-origem { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: #fff; }
					.power-type-classe { background: linear-gradient(135deg, #e67e22 0%, #d35400 100%); color: #fff; }
					.power-type-habilidade-de-classe { background: linear-gradient(135deg, #f5c242 0%, #f39c12 100%); color: #fff; }
					.power-type-habilidade_de_classe { background: linear-gradient(135deg, #f5c242 0%, #f39c12 100%); color: #fff; }
					.power-type-racial { background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: #fff; }
					.power-type-concedido { background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%); color: #fff; }
					.power-type-distinção { background: linear-gradient(135deg, #16a085 0%, #138d75 100%); color: #fff; }
					.power-type-distincao { background: linear-gradient(135deg, #16a085 0%, #138d75 100%); color: #fff; }
					.power-type-complicação { background: linear-gradient(135deg, #c0392b 0%, #a93226 100%); color: #fff; }
					.power-type-complicacao { background: linear-gradient(135deg, #c0392b 0%, #a93226 100%); color: #fff; }
					.power-type-complicacão { background: linear-gradient(135deg, #c0392b 0%, #a93226 100%); color: #fff; }
					
					.power-controls {
						display: flex;
						gap: 5px;
					}
					
					.power-control {
						padding: 8px 12px;
						background: rgba(255, 255, 255, 0.08);
						border: 2px solid rgba(255, 255, 255, 0.12);
						border-radius: 8px;
						color: #fff;
						cursor: pointer;
						transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
						position: relative;
						overflow: hidden;
						box-shadow: 
							inset 0 2px 4px rgba(0, 0, 0, 0.2),
							0 2px 4px rgba(0, 0, 0, 0.1);
					}
					
					.power-control::before {
						content: '';
						position: absolute;
						top: 50%;
						left: 50%;
						width: 0;
						height: 0;
						border-radius: 50%;
						background: rgba(255, 255, 255, 0.2);
						transform: translate(-50%, -50%);
						transition: width 0.4s ease, height 0.4s ease;
					}
					
					.power-control:hover {
						background: rgba(255, 255, 255, 0.15);
						border-color: rgba(255, 255, 255, 0.3);
						transform: translateY(-3px) scale(1.08);
						box-shadow: 
							0 6px 16px rgba(0, 0, 0, 0.4),
							inset 0 1px 0 rgba(255, 255, 255, 0.2);
					}
					
					.power-control:hover::before {
						width: 200px;
						height: 200px;
					}
					
					.power-control i {
						position: relative;
						z-index: 1;
						transition: transform 0.25s ease;
					}
					
					.power-control:hover i {
						transform: scale(1.15);
					}
					
					.power-control.item-delete:hover {
						background: rgba(192, 57, 43, 0.3);
						border-color: rgba(192, 57, 43, 0.6);
						color: #ffcccc;
					}
					
					.power-control.item-edit:hover {
						background: rgba(74, 144, 226, 0.3);
						border-color: rgba(74, 144, 226, 0.6);
						color: #b3d9ff;
					}
					
					.power-control.item-create {
						background: linear-gradient(135deg, rgba(245, 194, 66, 0.2) 0%, rgba(230, 126, 34, 0.2) 100%);
						border-color: rgba(245, 194, 66, 0.4);
						color: #f5c242;
						font-weight: 600;
						text-transform: uppercase;
						letter-spacing: 0.5px;
						font-size: 12px;
					}
					
					.power-control.item-create:hover {
						background: linear-gradient(135deg, rgba(245, 194, 66, 0.4) 0%, rgba(230, 126, 34, 0.4) 100%);
						border-color: rgba(245, 194, 66, 0.7);
						color: #ffffff;
						box-shadow: 
							0 6px 20px rgba(245, 194, 66, 0.4),
							inset 0 1px 0 rgba(255, 255, 255, 0.2);
					}
					
					.power-control.item-create i {
						margin-right: 6px;
					}
					</style>
					
					<div class="powers-header">
						<h3>{{localize "T20.Powers"}}</h3>
						<a class="item-control item-create power-control" title="{{localize 'T20.ItemCreate'}}" data-type="poder">
							<i class="fas fa-plus"></i> {{localize "T20.Add"}}
						</a>
					</div>
					
					<div class="powers-combobox-container">
						<select class="powers-combobox" id="powers-combobox">
							<option value="">Todos os tipos</option>
							<!-- Opções serão preenchidas dinamicamente via JavaScript -->
						</select>
					</div>
					
					<div class="powers-chips" id="powers-chips-container" style="display: none;">
						<!-- Mantido para compatibilidade com JavaScript -->
					</div>
					
					
					<div class="powers-list" id="powers-list-container">
						{{#if actor.poderesPorTipo.length}}
							{{#each actor.poderesPorTipo as |grupo|}}
							<div class="powers-group" data-power-group="{{grupo.tipo}}">
								<div class="powers-group-header">
									<span class="group-title">{{grupo.label}}</span>
									<span class="group-count">{{grupo.count}}</span>
								</div>
								
								{{#each grupo.items as |item id|}}
								<div class="power-item" data-item-id="{{item._id}}" data-power-name="{{item.name}}" data-power-type="{{item.tipo}}">
									<div class="power-item-row">
										<div class="power-icon item-image rollable" data-item-id="{{item._id}}" style="background-image: url('{{item.img}}')" title="{{item.name}}"></div>
										<div class="power-info">
											<div class="power-name">{{item.name}}</div>
											<div class="power-activation" data-item-id="{{item._id}}">
												<span class="activation-text">-</span>
												<span class="mana-cost" style="display: none;"></span>
											</div>
										</div>
										<div class="power-type-badge power-type-placeholder" style="display: none;"></div>
										<div class="power-controls">
											<a class="item-control item-edit power-control" title="{{localize 'T20.ItemEdit'}}" data-item-id="{{item._id}}">
												<i class="fas fa-edit"></i>
											</a>
											<a class="item-control item-delete power-control" title="{{localize 'T20.ItemDelete'}}" data-item-id="{{item._id}}">
												<i class="fas fa-trash"></i>
											</a>
										</div>
									</div>
								</div>
								{{/each}}
							</div>
							{{/each}}
						{{else}}
							{{#each actor.poderes as |item id|}}
							<div class="power-item" data-item-id="{{item._id}}" data-power-name="{{item.name}}" data-power-type="">
								<div class="power-item-row">
									<div class="power-icon item-image rollable" data-item-id="{{item._id}}" style="background-image: url('{{item.img}}')" title="{{item.name}}"></div>
									<div class="power-info">
										<div class="power-name">{{item.name}}</div>
										<div class="power-activation" data-item-id="{{item._id}}">
											<span class="activation-text">-</span>
											<span class="mana-cost" style="display: none;"></span>
										</div>
									</div>
									<div class="power-type-badge power-type-placeholder" style="display: none;"></div>
									<div class="power-controls">
										<a class="item-control item-edit power-control" title="{{localize 'T20.ItemEdit'}}" data-item-id="{{item._id}}">
											<i class="fas fa-edit"></i>
										</a>
										<a class="item-control item-delete power-control" title="{{localize 'T20.ItemDelete'}}" data-item-id="{{item._id}}">
											<i class="fas fa-trash"></i>
										</a>
									</div>
								</div>
							</div>
							{{/each}}
						{{/if}}
					</div>
				</div>

				{{#if actor.maiorCirculo}}
				{{!-- Spells --}}
				<div class="list-spells">
					{{> "tormenta20.list-spells"}}
				</div>
				{{/if}}

				{{!-- Traits --}}
				<div class="traits">
					{{> "tormenta20.traits"}}
					<textarea name="system.detalhes.info" rows="10">{{system.detalhes.info}}</textarea>
				</div>
			</div>
			<div class="attributes-right flexcol">
				{{!-- Skills --}}
				{{> "tormenta20.list-skills"}}

				{{!-- Inventory General --}}
				<div class="inventory-list">
					{{> "tormenta20.list-general"}}
					{{> "tormenta20.currency"}}
					{{> "tormenta20.encumbrance"}}
				</div>
			</div>
		</div>

		{{!-- Biography Tab --}}
		<div class="tab journal flexrow flex-between" data-group="primary" data-tab="journal">
			{{> "tormenta20.journal"}}
		</div>

		{{!-- Modifiers Tab --}}
		<div class="tab modifiers" data-group="primary" data-tab="modifiers">
			{{> "tormenta20.modifiers"}}
		</div>

		{{!-- Efeitos Tab --}}
		<div class="tab effects" data-group="primary" data-tab="effects">
			{{> "tormenta20.active-effects"}}
		</div>
	</section>
</form>
